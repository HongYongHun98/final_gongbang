<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

<insert id="add" parameterType="com.spring.gotgongbang.board.model.InquiryVO">
 	    insert into INQUIRY(inquiry_num_pk, user_id_fk, inquiry_title, inquiry_content, inquiry_group, inquiry_original, inquiry_depth,inquiry_date, inquiry_viewcount)
		values(seq_inquiry_num_pk.nextval, 'wlgus', #{inquiry_title}, #{inquiry_content}, 1, 1, 1, default, default)
</insert>


<!-- 파일 첨부 기능이 있는 온라인 문의 -->
	<insert id="add_withFile" parameterType="com.spring.gotgongbang.board.model.InquiryVO">
		insert into INQUIRY(inquiry_num_pk, user_id_fk, inquiry_title, inquiry_content, inquiry_group, inquiry_original, inquiry_depth, inquiry_date, inquiry_viewcount, inquiry_status, inquiry_fileName, inquiry_orgFilename, inquiry_fileSize)
		values(seq_inquiry_num_pk.nextval, 'wlgus', #{inquiry_title}, #{inquiry_content}, 1, 1, 1, default, default, default, #{inquiry_content}, #{inquiry_orgFilename}, #{inquiry_fileSize})
	</insert>
	
<!-- 질문게시판 데이터 넘기기 -->	

	<select id="BoardQuestionList" resultType="com.spring.gotgongbang.board.model.InquiryVO">
		select inquiry_num_pk, user_id_fk, inquiry_title, to_char(inquiry_date, 'yyyy-mm-dd hh24:mm:ss') as inquiry_date
		from INQUIRY 
		where inquiry_status = 1
		order by inquiry_num_pk desc
	</select> 
	
<!-- 총 게시물 건수 구하기 -->	
	 
	 <select id="getTotalCount" parameterType="HashMap" resultType="int"> 
	   select count(*)
	   from INQUIRY
	   where inquiry_status = 1 
	   <if test='searchType != ""'>
	   and lower(${searchType}) like '%'|| lower(#{searchWord}) ||'%'
	   </if>
	 </select>
	 
<!-- 페이징 처리한 글목록 가져오기 -->
	<select id="iqListSearchWithPaging" parameterType="HashMap" resultType="com.spring.gotgongbang.board.model.InquiryVO">
		select inquiry_num_pk, user_id_fk, inquiry_title, inquiry_viewcount, inquiry_date
		from 
		(
		  select row_number() over(order by inquiry_num_pk desc) AS rno,
		         inquiry_num_pk, user_id_fk, inquiry_title, inquiry_viewcount,
		         to_char(inquiry_date, 'yyyy-mm-dd hh24:mi:ss') AS inquiry_date 
		         
		  from INQUIRY
		  where inquiry_status = 1
		<if test='searchType != "" and searchWord != ""'>
		  and lower(${searchType}) like '%'|| lower(#{searchWord}) || '%'
		</if>
		) V 
		where rno between #{startRno} and #{endRno}
	</select>	 
	
</mapper>
